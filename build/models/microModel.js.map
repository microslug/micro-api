{"version":3,"sources":["../../src/models/microModel.js"],"names":["writeNewUrl","url","dbConnected","Promise","reject","logger","info","resolve","db","then","slug","reply","microURL","process","env","MICRO_URL","destinationURL","write","catch","getUrlFromSlug","error","getSize","console","log","status"],"mappings":";;;;;;;AASA;;AACA;;AACA;;AACA;;AACA;;AAIO,IAAMA,oCAAc,SAAdA,WAAc,CAACC,GAAD,EAAS;AAClC,MAAI,CAACC,mBAAL,EAAkB,OAAOC,QAAQC,MAAR,CAAe,KAAf,CAAP;AAClBC,iBAAOC,IAAP,CAAY,0BAAwBL,GAApC;AACA,SAAO,IAAIE,OAAJ,CAAa,UAACI,OAAD,EAASH,MAAT,EAAoB;AACtC,mCAAaI,UAAb,EAAgBP,GAAhB,EACGQ,IADH,CACQ,UAACC,IAAD,EAAS;AACbL,qBAAOC,IAAP,CAAY,gCAA8BI,IAA1C;AACA,UAAMC,QAAQ;AACZC,kBAAaC,QAAQC,GAAR,CAAYC,SAAzB,SAAsCL,IAD1B;AAEZM,wBAAgBf,GAFJ;AAGZS,kBAHY;AAIZO,eAAO;AAJK,OAAd;AAMAV,cAASI,KAAT;AACD,KAVH,EAWGO,KAXH,CAWS,UAACP,KAAD,EAAW;AAChBN,qBAAOC,IAAP,CAAY,wCAAsCK,KAAlD;AACAP,aAAQ,oBAAR,EAA6BO,KAA7B;AACD,KAdH;AAeD,GAhBM,CAAP;AAiBD,CApBM;;AAsBP;AAvCA;;;;;;;;AAwCO,IAAMQ,0CAAiB,SAAjBA,cAAiB,CAACT,IAAD,EAAU;AACtC;AACAL,iBAAOC,IAAP,CAAY,oCAAkCI,IAA9C;AACA,MAAI,CAACR,mBAAL,EAAkB,OAAOC,QAAQC,MAAR,CAAe,KAAf,CAAP;AAClB,SAAO,IAAID,OAAJ,CAAa,UAACI,OAAD,EAASH,MAAT,EAAoB;AACtC,QAAMH,MAAM,0CAAkBO,UAAlB,EAAqBE,IAArB,EACTD,IADS,CACJ,UAACR,GAAD,EAAQ;AACZI,qBAAOC,IAAP,CAAY,kCAAgCL,GAA5C;AACAM,cAASN,GAAT;AACD,KAJS;AAKV;AALU,KAMTiB,KANS,CAMH,UAACjB,GAAD,EAAS;AACdI,qBAAOe,KAAP,CAAa,kCAAgCnB,GAA7C;AACAA,YAAM,KAAN;AACAM,cAAQN,GAAR;AACD,KAVS,CAAZ;AAWD,GAZM,CAAP;AAaD,CAjBM;;AAmBA,IAAMoB,4BAAU,SAAVA,OAAU,GAAM;AAC3B,MAAI,CAACnB,mBAAL,EAAkB,OAAOC,QAAQC,MAAR,CAAe,KAAf,CAAP;AAClBC,iBAAOC,IAAP,CAAY,mBAAZ;;AAEA,SAAO,IAAIH,OAAJ,CAAa,UAACI,OAAD,EAASH,MAAT,EAAoB;AACtCkB,YAAQC,GAAR,CAAY,IAAZ;AACA,0CAAgBf,UAAhB,EACGC,IADH,CACQ,UAACe,MAAD,EAAW;AACfnB,qBAAOC,IAAP,CAAY,8BAA4BkB,MAAxC;AACAjB,cAASiB,MAAT;AACD,KAJH,EAKGN,KALH,CAKS,UAACM,MAAD,EAAY;AACjBnB,qBAAOe,KAAP,CAAa,8BAA4BI,MAAzC;AACAjB,cAAQiB,MAAR;AACD,KARH;AASD,GAXM,CAAP;AAYD,CAhBM","file":"microModel.js","sourcesContent":["/********************************************************************************\n *\n * Models\n * Simple DB Schema\n * --slug\n * --destination\n ********************************************************************************/\n\n\nimport { db, dbConnected } from './initDB';\nimport { generateSlug } from './slugCreator';\nimport { logger } from '../utils/logger';\nimport { getDestinationUrl } from './getDestinationUrl';\nimport { getDataBaseSize } from './getDataBaseSize';\n\n\n\nexport const writeNewUrl = (url) => {\n  if (!dbConnected) return Promise.reject(false);\n  logger.info('writeNewUrl: Writing '+url);\n  return new Promise( (resolve,reject) => {\n    generateSlug(db,url)\n      .then((slug) =>{\n        logger.info('generateSlug: Got new slug '+slug);\n        const reply = {\n          microURL: `${process.env.MICRO_URL}/${slug}`,\n          destinationURL: url,\n          slug,\n          write: 'ok'\n        };\n        resolve (reply);\n      })\n      .catch((reply) => {\n        logger.info('generateSlug: unable to write slug '+reply);\n        reject ('writeNewUrl: fail ',reply);\n      });\n  });\n};\n\n// Always returns a URL!!\nexport const getUrlFromSlug = (slug) => {\n  //console.log('getUrlFromSlug, Database size: ',dbKeySize);\n  logger.info('  Model: getUrlFromSlug: slug ='+slug);\n  if (!dbConnected) return Promise.reject(false);\n  return new Promise( (resolve,reject) => {\n    const url = getDestinationUrl(db,slug)\n      .then((url) =>{\n        logger.info('  Model: getUrlFromSlug: url='+url);\n        resolve (url);\n      })\n      // Url bad\n      .catch((url) => {\n        logger.error('  Model: getUrlFromSlug: url='+url);\n        url = 'bad';\n        resolve(url);\n      });\n  });\n};\n\nexport const getSize = () => {\n  if (!dbConnected) return Promise.reject(false);\n  logger.info('  Model: getSize:');\n\n  return new Promise( (resolve,reject) => {\n    console.log('ok')\n    getDataBaseSize(db)\n      .then((status) =>{\n        logger.info('  Model: getSize: status='+status);\n        resolve (status);\n      })\n      .catch((status) => {\n        logger.error('  Model: getSize: status='+status);\n        resolve(status);\n      });\n  });\n};\n"]}