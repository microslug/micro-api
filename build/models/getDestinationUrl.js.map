{"version":3,"sources":["../../src/models/getDestinationUrl.js"],"names":["getDestinationUrl","db","slug","logger","info","Promise","resolve","reject","get","then","url","error","decodeURIComponent","set","process","env","SLUG_EXPIRY","status","err"],"mappings":";;;;;;;AAAA;;AACA;;;;;;AAMO,IAAMA,gDAAoB,SAApBA,iBAAoB,CAACC,EAAD,EAAIC,IAAJ,EAAa;AAC5CC,iBAAOC,IAAP,CAAY,6CAA2CF,IAAvD;AACA,SAAO,IAAIG,OAAJ,CAAa,UAACC,OAAD,EAASC,MAAT,EAAoB;AACtCN,OAAGO,GAAH,CAAON,IAAP,EAAaO,IAAb,CAAoB,UAACC,GAAD,EAAKC,KAAL,EAAe;AACjC,UAAIA,KAAJ,EAAW;AACTJ,eAAOI,KAAP;AACD;AACDD,YAAM,CAACA,GAAD,GAAOA,GAAP,GAAaE,mBAAmBF,GAAnB,CAAnB;AACAP,qBAAOC,IAAP,CAAY,2CAAyCM,GAArD;AACA;AACA,UAAIA,GAAJ,EAAS;AACPT,WAAGY,GAAH,CAAOX,IAAP,EAAYQ,GAAZ,EAAgB,IAAhB,EAAsBI,QAAQC,GAAR,CAAYC,WAAlC,EAA+CP,IAA/C,CAAsD,UAACQ,MAAD,EAAQN,KAAR,EAAkB;AACtE,cAAIA,KAAJ,EAAW;AACT,mBAAOR,eAAOQ,KAAP,CAAaO,GAAb,CAAP;AACD;AACDf,yBAAOC,IAAP,CAAY,wCAAsCU,QAAQC,GAAR,CAAYC,WAA9D;AACD,SALD;AAMD;AACDV,cAAQI,GAAR;AACD,KAhBD;AAiBD,GAlBM,CAAP;AAmBD,CArBM","file":"getDestinationUrl.js","sourcesContent":["import { logger } from '../utils/logger';\n/********************************************************************************\n *\n * Get destination URL\n *\n ********************************************************************************/\n\nexport const getDestinationUrl = (db,slug) => {\n  logger.info('    SubModel: getDestinationUrl: slug = '+slug);\n  return new Promise( (resolve,reject) => {\n    db.get(slug).then ( (url,error) => {\n      if (error) {\n        reject(error);\n      }\n      url = !url ? url : decodeURIComponent(url);\n      logger.info('    SubModel: getDestinationUrl: url ='+url);\n      // update timeout if slug found\n      if (url) {\n        db.set(slug,url,'EX', process.env.SLUG_EXPIRY).then ( (status,error) => {\n          if (error) {\n            return logger.error(err);\n          }\n          logger.info('      SubModel: slug expiry reset  '+process.env.SLUG_EXPIRY);\n        });\n      }\n      resolve(url);\n    })\n  });\n};\n"]}